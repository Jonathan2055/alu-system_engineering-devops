#!/usr/bin/env bash
# Configure a custom 404 page with Nginx

# Exit on error
set -e

# Install nginx if not already installed
if ! command -v nginx >/dev/null; then
    apt-get update -y
    apt-get install nginx -y
fi

# Create the custom 404 error page
echo "Ceci n'est pas une page" > /var/www/html/custom_404.html

# Nginx config file
CONFIG="/etc/nginx/sites-available/default"

# Only add the error_page directive if it's not already present
if ! grep -q "error_page 404 /custom_404.html;" "$CONFIG"; then
    awk '
    /server {/ { print; found=1; next }
    found && /\}/ && !done {
        print "    error_page 404 /custom_404.html;";
        done=1
    }
    { print }
    ' "$CONFIG" > /tmp/default && mv /tmp/default "$CONFIG"
fi

# Restart nginx to apply changes
service nginx restart
